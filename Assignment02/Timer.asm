CPU "8085.TBL"
HOF "INT8"

GTHEX: EQU 030EH
HXDSP: EQU 034FH
OUTPUT: EQU 0389H
CLEAR: EQU 02BEH
RDKBD: EQU 03BAH
UPDDT: EQU 044CH
UPDAD: EQU 0440H

ORG 9400H
PUSH PSW
CALL RDKBD
POP PSW
EI
RET


ORG 9000H

; --------------------------------
; 8000H - hours
; 8001H - minute
; 8002H - seconds
; 8010-8012H - temporary locations
; --------------------------------



CALL INIT

START:
  LOOP1:
    EI
    MVI A, 18H
    STA 8011H
    LDA 8012H
    CPI 00H
    JZ DECREMENT_SECOND
    LDA 8012H
    DCR A
    STA 8012H
    JMP LOOP2

  LOOP2:
    EI
    MVI A, 4CH
    STA 8010H
    LDA 8011H
    CPI 00H
    JZ LOOP1
    LDA 8011H
    DCR A
    STA 8011H
    JMP LOOP3

  LOOP3:
    EI
    LDA 8010H
    CPI 00H
    JZ LOOP2
    LDA 8010H
    DCR A
    STA 8010H
    JMP LOOP3

  DECREMENT_SECOND:
    EI
    LDA 800AH
    CPI 00H
    JZ DECREMENT_SECOND
    EI
    LDA 8002H
    CPI 00H
    JZ DECREMENT_MIN
    LDA 8002H
   	ANI 0FH
   	XRI 00H
   	LDA 8002H
   	JZ DCR_6_SECOND

   	BACK_SECOND:
    DCR A
    STA 8002H
    CALL INIT
    JMP LOOP1

  DECREMENT_MIN:
    EI
    CALL RESET_SECOND
    LDA 8001H
    CPI 00H
    JZ DECREMENT_HOUR
    LDA 8001H
    ANI 0FH
   	XRI 00H
   	LDA 8001H
   	JZ DCR_6_MIN

   	BACK_MIN:
    DCR A
    STA 8001H
    CALL INIT
    JMP LOOP1

  DECREMENT_HOUR:
    EI
    LDA 8000H
    CPI 00H
    JZ HALT
    CALL RESET_MIN
    LDA 8000H
    ANI 0FH
   	XRI 00H
   	LDA 8000H
   	JZ DCR_6_MIN

    BACK_HOUR:
    DCR A
    STA 8000H
    CPI 24H
    JZ RESET_HOUR
    CALL INIT
    JMP LOOP1
  
  HALT:
    RST 5
  
  DCR_6_SECOND:
  	DCR A
  	DCR A
  	DCR A
  	DCR A
  	DCR A
  	DCR A

    JMP BACK_SECOND

  DCR_6_MIN:
  	DCR A
  	DCR A
  	DCR A
  	DCR A
  	DCR A
  	DCR A

    JMP BACK_MIN

  DCR_6_HOUR:
  	DCR A
  	DCR A
  	DCR A
  	DCR A
  	DCR A
  	DCR A

    JMP BACK_HOUR


INIT:
  MVI A,0BH
  SIM
  EI
  MVI A, 4CH
  STA 8010H
  MVI A, 18H
  STA 8011H
  STA 8012H
  CALL DISPLAY_SECOND
  CALL DISPLAY_MIN
  CALL DISPLAY_HOUR
  EI
  RET

RESET:
  EI
  MVI A,0BH
  SIM
  EI
  MVI A, 00H
  STA 8002H
  STA 8001H
  STA 8000H
  MVI A, 18H
  STA 8010H
  STA 8011H
  STA 8012H
  EI
  RET

RESET_SECOND:
  EI
  MVI A, 59H
  STA 8002H
  RET

RESET_MIN:
  EI
  MVI A, 59H
  STA 8001H
  RET

RESET_HOUR:
  EI
  MVI A, 59H
  STA 8000H
  CALL INIT
  JMP START


DISPLAY_SECOND:
  EI
  LDA 8002H
  STA 8FF1H
  CALL UPDDT 
  EI
  RET

DISPLAY_MIN:
  EI
  LDA 8001H
  STA 8FEFH
  CALL UPDAD
  EI 
  RET

DISPLAY_HOUR:
  EI
  LDA 8000H
  STA 8FF0H
  CALL UPDAD 
  EI
  RET

